<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Laporan Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Sidebar -->
  <div class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out" id="sidebar">
        <div class="flex items-center justify-between h-16 px-4 bg-gradient-to-r from-blue-600 to-indigo-600">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                    <img src="Logo.png" alt="Logo">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </img>
                </div>
                <span class="text-white font-bold text-lg">Laporan Invoice</span>
            </div>
            <!-- Close button for mobile -->
            <button onclick="toggleSidebar()" class="lg:hidden p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <aside class="w-64 bg-white border-r h-screen overflow-y-auto">
            <nav class="mt-10 px-4">
                <div class="space-y-2">
                    <!-- Dashboard -->
                    <a href="manajemen.html" class="flex items-center px-4 py-3 text-gray-700 rounded-lg font-medium hover:bg-blue-50 hover:text-blue-600 transition-colors font-medium">
                        <i class="fa-solid fa-house w-5 h-5 mr-3"></i>
                        Manajemen
                    </a>
                    
                    <!-- Laporan Invoice (Active) -->
                    <a href="#" class="flex items-center px-4 py-3 text-blue-600 bg-blue-50 rounded-lg font-medium">
                        <i class="fa-solid fa-file-invoice w-5 h-5 mr-3"></i>
                        Laporan Invoice
                    </a>
                    
                    <!-- Pembayaran -->
                    <a href="pembayaran.html" class="flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors font-medium">
                        <i class="fa-solid fa-credit-card w-5 h-5 mr-3"></i>
                        Pembayaran
                    </a>
                    
                    <!-- Tambah Data -->
                    <a href="tambah_data.html" class="flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors font-medium">
                        <i class="fa-solid fa-user-plus w-5 h-5 mr-3"></i>
                        Tambah Data
                    </a>
                    
                    <!-- Laporan -->
                    <a href="laporan.html" class="flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors font-medium">
                        <i class="fa-solid fa-chart-bar w-5 h-5 mr-3"></i>
                        Laporan
                    </a>
                </div>
                
                <!-- User Profile Section -->
                 <div class="mt-32 pt-8 border-t border-gray-200">
                    <a href="#" class="flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-colors font-medium">
                        <i class="fa-solid fa-right-from-bracket w-5 h-5 mr-3"></i>
                        Keluar
                    </a>
                </div>
            </nav>
        </aside>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden hidden" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Header -->
    <header class="bg-white shadow-lg border-b border-gray-200 lg:ml-64 fixed w-full z-50">
        <div class="px-4 sm:px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2 sm:space-x-4 flex-1 min-w-0">
                    <!-- Mobile menu button -->
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors flex-shrink-0">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    
                    <div class="min-w-0 flex-1">
                        <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 truncate">Laporan Invoice</h1>
                        <p class="text-xs sm:text-sm text-gray-600 hidden sm:block">Akses dan cetak laporan invoice</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4 flex-shrink-0">
                    <!-- Notifications -->
                    <button class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                        <i class="fa fa-bell" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="lg:ml-64 px-4 sm:px-6 py-6 sm:py-8">
        <!-- Search Bar -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 mt-20">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 sm:h-5 sm:w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input type="text" id="searchInput" placeholder="Cari nama siswa atau sekolah..." class="block w-full pl-9 sm:pl-10 pr-3 py-2 sm:py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
            </div>
        </div>

        <!-- Filter Section -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-4 sm:mb-6 flex items-center">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                </svg>
                Filter Laporan
            </h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 xl:gap-6">
                <!-- Filter Kelas Level -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Kelas Level Pembelajaran</label>
                    <select id="kelasFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua Level</option>
                    </select>
                </div>

                <!-- Filter Kategori Kelas -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Kategori Kelas</label>
                    <select id="kategoriFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua Kelas</option>
                    </select>
                </div>

                <!-- Filter Sekolah -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Sekolah</label>
                    <select id="sekolahFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua Sekolah</option>
                    </select>
                </div>

                <!-- filter pelunasan -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Status Pembayaran (tidak yang kosong)</label>
                    <select id="statusFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua</option>
                        <option value="Lunas">Lunas</option>
                        <option value="Belum Lunas">Belum Lunas</option>
                        <option value='Kosong'>Belum Terisi</option>
                    </select>
                </div>

                <!-- filter bulan -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Bulan</label>
                    <select id="bulanFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua Bulan</option>
                        <option value="januari">Januari</option>
                        <option value="februari">Februari</option>
                        <option value="maret">Maret</option>
                        <option value="april">April</option>
                        <option value="mei">Mei</option>
                        <option value="juni">Juni</option>
                        <option value="juli">Juli</option>
                        <option value="agustus">Agustus</option>
                        <option value="september">September</option>
                        <option value="oktober">Oktober</option>
                        <option value="november">November</option>
                        <option value="desember">Desember</option>
                    </select>
                </div>

            <!-- filter tahun -->
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Tahun</label>
                    <select id="tahunFilter" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <!-- Tombol Filter -->
                <div class="flex items-end sm:col-span-2 xl:col-span-1 w-full">
                    <button onclick="applyFilters()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 font-medium flex items-center justify-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <span class="hidden sm:inline">Terapkan Filter</span>
                        <span class="sm:hidden">Filter</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">Total Siswa</p>
                        <p class="text-lg sm:text-2xl font-bold text-gray-900" id="totalSiswa">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                        <i class="fa fa-user w-4 h-4" aria-hidden="true"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600">Pembayaran Lunas</p>
                        <p class="text-lg sm:text-2xl font-bold text-green-600" id="siswaLunas">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                        <svg class="w-4 h-4 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600">Belum Lunas</p>
                        <p class="text-lg sm:text-2xl font-bold text-red-600" id="siswaBelumLunas">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                        <svg class="w-4 h-4 sm:w-6 sm:h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 col-span-2 lg:col-span-1">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600">Total Pendapatan</p>
                        <p class="text-lg sm:text-2xl font-bold text-purple-600" id="totalPendapatan">Rp 0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-4 py-4 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Data Laporan Siswa</h3>
            </div>
            
            <!-- Mobile and Desktop Table View -->
            <div class="overflow-x-auto">
                <table class="w-full min-w-[800px]">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                <input type="checkbox" id="selectAll" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" onchange="toggleSelectAll()">
                            </th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Nama Siswa</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Kelas Level</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Kategori</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Sekolah</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Biaya Pendaftaran</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Status</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Bulan pendaftaran</th>
                            <th class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="bg-white divide-y divide-gray-200">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="px-4 py-4 sm:px-6 border-t border-gray-200 bg-gray-50 ">
                <div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0">
                    <!-- Info Text -->
                    <div class="text-sm text-gray-700">
                        Menampilkan <span id="startRecord" class="font-medium">0</span> sampai 
                        <span id="endRecord" class="font-medium">10</span> dari 
                        <span id="totalRecords" class="font-medium">0</span> data
                    </div>
                    <!-- Pagination Buttons -->
                    <div class="flex items-center space-x-2">
                        <button id="prevBtn" onclick="changePage(-1)" 
                            class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            Sebelumnya
                        </button>
                    
                        <div id="pageNumbers" class="flex space-x-1">
                            <!-- Page numbers akan diisi oleh JavaScript -->
                        </div>
                    
                        <button id="nextBtn" onclick="changePage(1)" 
                            class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            Selanjutnya
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 mb-6 sm:mt-8 flex flex-col sm:flex-row gap-4 justify-between items-center">
            <!-- Invoice Button -->
            <button onclick="createInvoice()" id="invoiceBtn" class="w-full sm:w-auto bg-gradient-to-r from-orange-600 to-red-600 text-white px-6 py-3 sm:px-8 rounded-lg hover:from-orange-700 hover:to-red-700 transition-all duration-200 font-medium flex items-center justify-center shadow-lg text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="hidden sm:inline">Buat Invoice</a> (<span id="selectedCount">0</span>)</span>
                <span class="sm:hidden">Buat Invoice</a> (<span id="selectedCountMobile">0</span>)</span>
            </button>
        </div>

        <!-- Modal Popup -->
          <div id="myModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                  <h2 id="modalTitle" class="text-xl font-semibold"></h2>
                  <span class="close text-gray-500 text-2xl cursor-pointer hover:text-gray-700">&times;</span>
                </div>
                
                <div id="paymentSummary" class="mb-4">
                  <p class="font-semibold"><span class="text-gray-600">Sudah Bayar:</span> <span id="paidCount"></span> kali</p>
                  <p class="font-semibold"><span class="text-gray-600">Total Sudah Dibayar:</span> <span id="totalPaid"></span></p>
                </div>
                
                <h3 class="text-lg font-semibold mb-2">Riwayat Pembayaran</h3>
                <div class="overflow-x-auto">
                  <table class="w-full border-collapse">
                    <thead>
                      <tr class="bg-gray-200">
                        <th class="border border-gray-300 p-2 text-left">Tanggal</th>
                        <th class="border border-gray-300 p-2 text-left">Jumlah Bayar</th>
                        <th class="border border-gray-300 p-2 text-left">Keterangan</th>
                      </tr>
                    </thead>
                    <tbody id="paymentHistory"></tbody>
                  </table>
                </div>
            </div>
          </div>
        </div>

        
    </div>


    <script>
      //buat array baru agar memudahkan pemanggilan data
      let dataInvoice = [];
      let filteredData = [];
      let currentPage = 1;
      const recordsPerPage = 10;
      let totalPages = 1;
      
      //ambil data dari file sss.json / database
      fetch("sss.json")
        .then(response => response.json())
        .then(data => {
          dataInvoice = data.sampleDataSiswa;
          renderTable(dataInvoice);
          updateSummary(dataInvoice);
          populateFilters(dataInvoice);
        }).catch(error => console.error('Data Gagal Dimuat', error));

      //format data
      function formatDateToMonthYear(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return '-';
        return date.toLocaleDateString("id-ID", { month: "long", year: "numeric" });
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat('id-ID', {
          style: 'currency',
          currency: 'IDR',
          minimumFractionDigits: 0
        }).format(amount);
      }
      
      function formatKelas(kelas) {
        return kelas
          .split("_")
          .map(kata => kata.charAt(0).toUpperCase() + kata.slice(1))
          .join(" ");
      }
      
      function formatNama(nama) {
        return nama
          .split("_")
          .map(kata => kata.charAt(0).toUpperCase() + kata.slice(1))
          .join(" ");
      }
      
      function formatKategori(pembelajaran) {
        return pembelajaran
          .split("_")
          .map(kata => kata.charAt(0).toUpperCase() + kata.slice(1))
          .join(" ");
      }
      
      function formatSekolah(sekolah) {
        return sekolah
          .split("_")
          .map(kata => kata.charAt(0).toUpperCase() + kata.slice(1))
          .join(" ");
      }
      
      function renderTable(data) {
        const tableBody = document.getElementById("dataTable");
        const startIndex = (currentPage - 1) * recordsPerPage;
        const endIndex = startIndex + recordsPerPage;
        const currentData = data.slice(startIndex, endIndex);
      
        tableBody.innerHTML = '';
      
        currentData.forEach(item => {
          const statusHightlight = item.status === 'Lunas' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
          const biaya = item.biaya === '' ? 'Belum Terisi' : formatCurrency(item.biaya);
          // GANTI item.tanggal -> item.tanggal_lunas
          const statusDate = item.tanggal_lunas && item.tanggal_lunas !== '' ? formatDateToMonthYear(item.tanggal_lunas) : '-';
          const nullDataMateri = item.pembelajaran === '' ? 'Kosong' : item.pembelajaran;
          const nullDataKelas = item.kelas === '' ? 'Kosong' : formatKelas(item.kelas);
      
          const row = document.createElement('tr');
          row.className = 'hover:bg-gray-50 transition-colors';
          row.innerHTML = `
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
              <input type="checkbox" class="row-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" data-nama="${item.nama}" data-biaya="${item.biaya}" onchange="updateSelectAll()">
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                  ${item.nama.charAt(0)}
                </div>
                <div class="ml-3">
                  <div class="text-sm font-medium text-gray-900">${item.nama}</div>
                </div>
              </div>
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                ${nullDataKelas}
              </span>
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">
                ${nullDataMateri}
              </span>
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${item.sekolah}
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              ${biaya}
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusHightlight}">
                ${item.status}
              </span>
            </td>
            <td class="px-4 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100  text-purple-800">
                ${statusDate}
              </span>
            </td>
            <td class="py-3">
              <button id="openModal" class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600" data-client-id=${item.nis}>Lihat Detail</button>
            </td>
          `;
          
          tableBody.appendChild(row);

          // Tambahkan event listener untuk setiap tombol
          document.querySelectorAll('button[data-client-id]').forEach(button => {
            button.addEventListener('click', function() {
              const clientId = this.getAttribute('data-client-id');
              fetchPaymentData(clientId);
              modal.classList.remove("hidden");
            });
          });
          
        });
      
        totalPages = Math.ceil(data.length / recordsPerPage);
        updatePaginationInfo(data);
        updatePaginationButtons(data);
      }

      // Ambil elemen
        const modal = document.getElementById("myModal");
        const btn = document.getElementById("openModal");
        const span = document.getElementsByClassName("close")[0];

      // Fungsi untuk menghitung sisa tagihan
        function calculateRemainingBill(dataInvoice) {
            const harga = dataInvoice.pembayaran.reduce((sum, ) => sum + pembayaran.jumlah, 0);
            return biaya - harga;
        }      

        // Fungsi ambil data dari JSON
        async function fetchPaymentData(siswaNis) {
          try {
            const response = await fetch('sss.json');
            const data = await response.json();
            
            // Cari klien berdasarkan client_id
            const client = data.sampleDataSiswa.find(n => n.nis == siswaNis);
            
            if (!client) {
              alert('Klien tidak ditemukan');
              return;
            }
            
            // Hitung data pembayaran
            const payments = client.pembayaran;
            const totalPaid = payments.reduce((sum, p) => sum + p.jumlah, 0);
            const paymentCount = payments.length;
            
            // Update modal title
            document.getElementById("modalTitle").textContent = `Keterangan Pembayaran - Klien: ${client.nama}`;
            
            // Update summary
            document.getElementById("paidCount").textContent = paymentCount;
            document.getElementById("totalPaid").textContent = formatCurrency(totalPaid);
            
            // Update tabel riwayat
            const tbody = document.getElementById("paymentHistory");
            tbody.innerHTML = '';
            payments.forEach(pembayaran => {
              const row = `
                <tr>
                  <td class="border border-gray-300 p-2">${pembayaran.tanggal}</td>
                  <td class="border border-gray-300 p-2">${formatCurrency(pembayaran.jumlah)}</td>
                  <td class="border border-gray-300 p-2">Cicilan ke: ${pembayaran.cicilan}</td>
                </tr>
              `;
              tbody.innerHTML += row;
            });
          } catch (error) {
            console.error('Error fetching data:', error);
            alert('Gagal mengambil data pembayaran. Pastikan file payments.json tersedia dan server CORS mendukung.');
          }
        }

        // Tutup modal
        span.onclick = function() {
            modal.classList.add("hidden");
        }

        // Tutup jika klik di luar modal
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.classList.add("hidden");
            }
        }
      
      //fungsi pembagian data jadi hanya 10 data saja yang di display
      function updatePaginationInfo(data) {
        const startRecord = (currentPage - 1) * recordsPerPage + 1;
        const endRecord = Math.min(currentPage * recordsPerPage, data.length);
      
        document.getElementById('startRecord').textContent = data.length ? startRecord : 0;
        document.getElementById('endRecord').textContent = data.length ? endRecord : 0;
        document.getElementById('totalRecords').textContent = data.length;
      
        pageNumbers.innerHTML = "";
      
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, startPage + 4);
      
        if (endPage - startPage < 4) {
          startPage = Math.max(1, endPage - 4);
        }
      
        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.textContent = i;
          pageBtn.onclick = () => goToPage(i);
          pageBtn.className = `px-3 py-2 text-sm font-medium border rounded-md ${
            i === currentPage
              ? "bg-blue-600 text-white border-blue-600"
              : "text-gray-500 bg-white border-gray-300 hover:bg-gray-50 hover:text-gray-700"
          }`;
          pageNumbers.appendChild(pageBtn);
        }
      }
      
      function updatePaginationButtons() {
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage === totalPages;
      }
      
      function changePage(direction) {
        if (direction === -1 && currentPage > 1) {
          currentPage--;
        } else if (direction === 1 && currentPage < totalPages) {
          currentPage++;
        }
        const data = filteredData.length ? filteredData : dataInvoice;
        renderTable(data);
      }
      
      function goToPage(page) {
        if (page >= 1 && page <= totalPages) {
          currentPage = page;
          const data = filteredData.length ? filteredData : dataInvoice;
          renderTable(data);
        }
      }
      
      //jika filter kategori privat maka filter sekolah tidak bisa berjalan
      document.addEventListener("DOMContentLoaded", function () {
        const kategoriFilter = document.getElementById("kategoriFilter");
        const sekolahFilter = document.getElementById("sekolahFilter");
        function updateSekolahFilter() {
          if (kategoriFilter.value.toLowerCase() === "private") {
            sekolahFilter.disabled = true;
            sekolahFilter.classList.add("bg-gray-100", "cursor-not-allowed", "text-gray-500");
          } else {
            sekolahFilter.disabled = false;
            sekolahFilter.classList.remove("bg-gray-100", "cursor-not-allowed", "text-gray-500");
          }
        }
        updateSekolahFilter();
        kategoriFilter.addEventListener("change", updateSekolahFilter);
      });

      //fungsi filter
      function applyFilters(searchTerm = searchInput.value.toLowerCase()) {
        const tahunFilter = document.getElementById('tahunFilter').value;
        const bulanFilter = document.getElementById('bulanFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;
        const kelasFilter = document.getElementById('kelasFilter').value;
        const kategoriFilter = document.getElementById('kategoriFilter').value;
        const sekolahFilter = document.getElementById('sekolahFilter').value;
      
        filteredData = dataInvoice.filter(item => {
          const kelasMatch = !kelasFilter || item.pembelajaran === kelasFilter;
          const kategoriMatch = !kategoriFilter || item.kelas === kategoriFilter;
          const sekolahMatch = !sekolahFilter || item.sekolah === sekolahFilter;
          const statusMatch = !statusFilter || item.status === statusFilter;
        
          const matchesSearch = item.nama && item.nama.toLowerCase().includes(searchTerm);
        
          let pelunasanMatch = true;
          if (statusFilter) {
            const status = item.status || "";
            if (statusFilter === "Lunas") {
              pelunasanMatch = status === "Lunas";
            } else if (statusFilter === "Belum Lunas") {
              pelunasanMatch = status === "Belum Lunas";
            } else if (statusFilter === "Kosong") {
              pelunasanMatch = status === "Kosong";
            }
          }
          // Filter Tahun
          let tahunMatch = true;
          if (tahunFilter && item.tanggal_lunas) {
            const tahun = new Date(item.tanggal_lunas).getFullYear().toString();
            tahunMatch = tahun === tahunFilter;
          }
        
          // Filter Bulan
          let bulanMatch = true;
          if (bulanFilter) {
            if (!item.tanggal_lunas) return false;
            const bulan = new Date(item.tanggal_lunas).toLocaleString("id-ID", { month: "long" }).toLowerCase();
            bulanMatch = bulan === bulanFilter.toLowerCase();
          }
        
          return kelasMatch && kategoriMatch && sekolahMatch && statusMatch && matchesSearch && pelunasanMatch && tahunMatch && bulanMatch;
        });
      
        renderTable(filteredData);
        updateSummary(filteredData);
      }
      
      function populateFilters(data) {
        const kelasSelect = document.getElementById("kategoriFilter");
        const pembelajaranSelect = document.getElementById("kelasFilter");
        const sekolahSelect = document.getElementById("sekolahFilter");
        const yearSelect = document.getElementById("tahunFilter");
      
        const kelasSet = new Set();
        const pembelajaranSet = new Set();
        const sekolahSet = new Set();
        const years = new Set();
      
        data.forEach(item => {
          sekolahSet.add(item.sekolah);
          kelasSet.add(item.kelas);
          pembelajaranSet.add(item.pembelajaran);
      
          if (item.tanggal_lunas) {
            years.add(new Date(item.tanggal_lunas).getFullYear());
          }
        });
      
        [...sekolahSet].sort().forEach(namaSekolah => {
          const opt = document.createElement("option");
          opt.value = namaSekolah;
          opt.textContent = formatSekolah(namaSekolah);
          sekolahSelect.appendChild(opt);
        });
        kelasSet.forEach(namaKelas => {
          const opt = document.createElement("option");
          opt.value = namaKelas;
          opt.textContent = formatSekolah(namaKelas);
          kelasSelect.appendChild(opt);
        });
        [...pembelajaranSet].sort().forEach(namaPembelajaran => {
          const opt = document.createElement("option");
          opt.value = namaPembelajaran;
          opt.textContent = formatSekolah(namaPembelajaran);
          pembelajaranSelect.appendChild(opt);
        });
        [...years].sort((a, b) => b - a).forEach(tahun => {
          const opt = document.createElement("option");
          opt.value = tahun;
          opt.textContent = tahun;
          yearSelect.appendChild(opt);
        });
      }
      
      function updateSummary(data) {
        const totalSiswa = data.length;
        const lunas = data.filter(item => item.status === 'Lunas').length;
        const belumLunas = totalSiswa - lunas;
        const totalPendapatan = data
          .filter(item => item && item.status === 'Lunas')
          .reduce((sum, item) => {
            const biaya = Number(item.biaya) || 0;
            return sum + biaya;
          }, 0);
        document.getElementById('totalSiswa').textContent = totalSiswa;
        document.getElementById('siswaLunas').textContent = lunas;
        document.getElementById('siswaBelumLunas').textContent = belumLunas;
        document.getElementById('totalPendapatan').textContent = formatCurrency(totalPendapatan);
      }
      
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (sidebar.classList.contains('-translate-x-full')) {
          sidebar.classList.remove('-translate-x-full');
          overlay.classList.remove('hidden');
        } else {
          sidebar.classList.add('-translate-x-full');
          overlay.classList.add('hidden');
        }
      }
      
      function toggleSelectAll() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const rowCheckboxes = document.querySelectorAll('.row-checkbox');
        rowCheckboxes.forEach(checkbox => {
          checkbox.checked = selectAllCheckbox.checked;
        });
        updateSelectedCount();
      }
      
      function updateSelectAll() {
        const rowCheckboxes = document.querySelectorAll('.row-checkbox');
        const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
        const selectAllCheckbox = document.getElementById('selectAll');
        if (checkedBoxes.length === 0) {
          selectAllCheckbox.indeterminate = false;
          selectAllCheckbox.checked = false;
        } else if (checkedBoxes.length === rowCheckboxes.length) {
          selectAllCheckbox.indeterminate = false;
          selectAllCheckbox.checked = true;
        } else {
          selectAllCheckbox.indeterminate = true;
          selectAllCheckbox.checked = false;
        }
        updateSelectedCount();
      }
      
      function updateSelectedCount() {
        const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
        const count = checkedBoxes.length;
        document.getElementById('selectedCount').textContent = count;
        document.getElementById('selectedCountMobile').textContent = count;
        const invoiceBtn = document.getElementById('invoiceBtn');
        invoiceBtn.disabled = count === 0;
      }
      
      function createInvoice() {
          const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
          if (!checkedBoxes.length) {
              alert('Pilih minimal satu siswa untuk membuat invoice!');
              return;
          }
          const selectedData = Array.from(checkedBoxes).map(checkbox => {
              const nama = checkbox.getAttribute('data-nama');
              const student = dataInvoice.find(item => item.nama === nama) || {};
              return {
                  nama: student.nama || '-',
                  pembelajaran: student.pembelajaran || '-',
                  status: student.status || '-',
                  biaya: parseInt(checkbox.getAttribute('data-biaya')) || 0,
                  skema: student.skema || ''
              };
          });
          localStorage.setItem('invoiceData', JSON.stringify(selectedData));
          window.location.href = "buat_invoice.html";
      }
      
    </script>
</body>
</html>